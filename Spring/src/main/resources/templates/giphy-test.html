<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giphy API í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .gif-container {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        border: 2px dashed #ddd;
        border-radius: 10px;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .gif-container img {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .btn {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s ease;
        margin: 10px;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .loading {
        color: #666;
        font-style: italic;
      }
      .error {
        color: #e74c3c;
        background: #fdf2f2;
        padding: 10px;
        border-radius: 5px;
        border-left: 4px solid #e74c3c;
      }
      .info {
        background: #e8f4fd;
        padding: 15px;
        border-radius: 5px;
        border-left: 4px solid #3498db;
        margin-bottom: 20px;
      }
      .gif-info {
        margin-top: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸƒâ€â™‚ï¸ ëœë¤ ëŸ¬ë‹ GIF í…ŒìŠ¤íŠ¸</h1>

      <div class="info">
        <strong>API ì •ë³´:</strong><br />
        â€¢ ë‹¨ì¼ GIF: <code>/api/giphy/random-running</code><br />
        â€¢ ë‹¤ì¤‘ GIF: <code>/api/giphy/multiple-random-running?count=5</code
        ><br />
        â€¢ Giphy API í‚¤: <code>ErmmZ2riyWkDwSkRT2z4BlNK8AmtJTDu</code><br />
        â€¢ ê²€ìƒ‰ íƒœê·¸:
        <code
          >running, jogging, marathon, sprint</code
        ><br />
        â€¢ ë“±ê¸‰: <code>g</code> (ëª¨ë“  ì—°ë ¹)
      </div>

      <div style="text-align: center">
        <button class="btn" onclick="loadRandomGif()" id="loadBtn">
          ğŸ² ëœë¤ ëŸ¬ë‹ GIF ê°€ì ¸ì˜¤ê¸°
        </button>
        <button
          class="btn"
          onclick="clearGif()"
          style="background: linear-gradient(45deg, #95a5a6, #7f8c8d)"
        >
          ğŸ—‘ï¸ ì§€ìš°ê¸°
        </button>
        <button
          class="btn"
          onclick="toggleAutoRefresh()"
          id="autoRefreshBtn"
          style="background: linear-gradient(45deg, #27ae60, #2ecc71)"
        >
          ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
        </button>
        <button
          class="btn"
          onclick="loadMultipleGifs()"
          id="multipleBtn"
          style="background: linear-gradient(45deg, #9b59b6, #8e44ad)"
        >
          ğŸš€ 5ê°œ GIF ì„¸íŠ¸ ë¡œë“œ
        </button>
        <button
          class="btn"
          onclick="nextGif()"
          id="nextBtn"
          style="background: linear-gradient(45deg, #3498db, #2980b9)"
        >
          â­ï¸ ë‹¤ìŒ GIF
        </button>
      </div>

      <div class="gif-container" id="gifContainer">
        <div class="loading">ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ëœë¤ ëŸ¬ë‹ GIFë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”!</div>
      </div>

      <div id="gifInfo" class="gif-info" style="display: none"></div>
    </div>

    <script>
      let currentGifData = null;
      let autoRefreshInterval = null;
      let isAutoRefreshing = false;
      let gifQueue = [];
      let currentGifIndex = 0;

      async function loadRandomGif() {
        const container = document.getElementById("gifContainer");
        const loadBtn = document.getElementById("loadBtn");
        const gifInfo = document.getElementById("gifInfo");

        // ë¡œë”© ìƒíƒœ
        loadBtn.disabled = true;
        loadBtn.textContent = "ğŸ”„ ë¡œë”© ì¤‘...";
        container.innerHTML =
          '<div class="loading">Giphy APIì—ì„œ ëœë¤ ëŸ¬ë‹ GIFë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';
        gifInfo.style.display = "none";

        // í ì´ˆê¸°í™”
        gifQueue = [];
        currentGifIndex = 0;

        try {
          // í˜„ì¬ í˜ì´ì§€ì˜ í”„ë¡œí† ì½œê³¼ í˜¸ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ API í˜¸ì¶œ
          const protocol = window.location.protocol;
          const host = window.location.host;
          const apiUrl = `${protocol}//${host}/api/giphy/random-running`;

          console.log("API í˜¸ì¶œ URL:", apiUrl);

          const response = await fetch(apiUrl);
          const data = await response.json();

          console.log("Giphy API ì‘ë‹µ:", data);

          if (data.error) {
            throw new Error(
              data.error + (data.message ? ": " + data.message : "")
            );
          }

          if (data.data && data.data.images) {
            currentGifData = data;
            const gifUrl = data.data.images.original.url;
            const title = data.data.title || "ì œëª© ì—†ìŒ";
            const rating = data.data.rating || "N/A";

            container.innerHTML = `
                        <img src="${gifUrl}" alt="${title}" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.3s ease;">
                        <div style="margin-top: 10px; font-weight: bold; color: #333;">${title}</div>
                    `;

            const usedTag = data.usedTag || "N/A";
            gifInfo.innerHTML = `
                        <strong>GIF ì •ë³´:</strong><br>
                        â€¢ ì œëª©: ${title}<br>
                        â€¢ ë“±ê¸‰: ${rating.toUpperCase()}<br>
                        â€¢ ID: ${data.data.id}<br>
                        â€¢ ê²€ìƒ‰ íƒœê·¸: ${usedTag}<br>
                        â€¢ ì›ë³¸ URL: <a href="${
                          data.data.url
                        }" target="_blank">Giphy í˜ì´ì§€ ë³´ê¸°</a>
                    `;
            gifInfo.style.display = "block";
          } else {
            throw new Error("GIF ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("Giphy API ì˜¤ë¥˜:", error);
          container.innerHTML = `
                    <div class="error">
                        <strong>ì˜¤ë¥˜ ë°œìƒ:</strong><br>
                        ${error.message}
                    </div>
                `;
        } finally {
          // ë²„íŠ¼ ìƒíƒœ ë³µì›
          loadBtn.disabled = false;
          loadBtn.textContent = "ğŸ² ëœë¤ ëŸ¬ë‹ GIF ê°€ì ¸ì˜¤ê¸°";
        }
      }

      async function loadMultipleGifs() {
        const container = document.getElementById("gifContainer");
        const multipleBtn = document.getElementById("multipleBtn");
        const gifInfo = document.getElementById("gifInfo");

        // ë¡œë”© ìƒíƒœ
        multipleBtn.disabled = true;
        multipleBtn.textContent = "ğŸ”„ 5ê°œ ë¡œë”© ì¤‘...";
        container.innerHTML =
          '<div class="loading">Giphy APIì—ì„œ 5ê°œì˜ ëœë¤ ëŸ¬ë‹ GIFë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';
        gifInfo.style.display = "none";

        // í ì´ˆê¸°í™”
        gifQueue = [];
        currentGifIndex = 0;

        try {
          const protocol = window.location.protocol;
          const host = window.location.host;
          const apiUrl = `${protocol}//${host}/api/giphy/multiple-random-running?count=5`;

          console.log("ë‹¤ì¤‘ GIF API í˜¸ì¶œ URL:", apiUrl);

          const response = await fetch(apiUrl);
          const data = await response.json();

          console.log("ë‹¤ì¤‘ Giphy API ì‘ë‹µ:", data);

          if (data.error) {
            throw new Error(
              data.error + (data.message ? ": " + data.message : "")
            );
          }

          if (data.success && data.data && data.data.length > 0) {
            gifQueue = data.data;
            currentGifIndex = 0;
            displayCurrentGif();
          } else {
            throw new Error("GIF ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ë‹¤ì¤‘ Giphy API ì˜¤ë¥˜:", error);
          container.innerHTML = `
                    <div class="error">
                        <strong>ì˜¤ë¥˜ ë°œìƒ:</strong><br>
                        ${error.message}
                    </div>
                `;
        } finally {
          // ë²„íŠ¼ ìƒíƒœ ë³µì›
          multipleBtn.disabled = false;
          multipleBtn.textContent = "ğŸš€ 5ê°œ GIF ì„¸íŠ¸ ë¡œë“œ";
        }
      }

      function displayCurrentGif() {
        const container = document.getElementById("gifContainer");
        const gifInfo = document.getElementById("gifInfo");

        if (gifQueue.length === 0) return;

        const currentGif = gifQueue[currentGifIndex];
        const gifUrl = currentGif.data.images.original.url;
        const title = currentGif.data.title || "ì œëª© ì—†ìŒ";
        const rating = currentGif.data.rating || "N/A";
        const usedTag = currentGif.usedTag || "N/A";

        container.innerHTML = `
                <img src="${gifUrl}" alt="${title}" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.3s ease;">
                <div style="margin-top: 10px; font-weight: bold; color: #333;">${title}</div>
                <div style="margin-top: 5px; font-size: 12px; color: #666;">
                    ${currentGifIndex + 1} / ${gifQueue.length} ë²ˆì§¸ GIF
                </div>
            `;

        gifInfo.innerHTML = `
                <strong>GIF ì •ë³´:</strong><br>
                â€¢ ì œëª©: ${title}<br>
                â€¢ ë“±ê¸‰: ${rating.toUpperCase()}<br>
                â€¢ ID: ${currentGif.data.id}<br>
                â€¢ ê²€ìƒ‰ íƒœê·¸: ${usedTag}<br>
                â€¢ ì›ë³¸ URL: <a href="${
                  currentGif.data.url
                }" target="_blank">Giphy í˜ì´ì§€ ë³´ê¸°</a>
            `;
        gifInfo.style.display = "block";
      }

      function nextGif() {
        if (gifQueue.length > 1) {
          currentGifIndex = (currentGifIndex + 1) % gifQueue.length;
          displayCurrentGif();
        }
      }

              function clearGif() {
          const container = document.getElementById("gifContainer");
          const gifInfo = document.getElementById("gifInfo");

          container.innerHTML =
            '<div class="loading">ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ëœë¤ ëŸ¬ë‹ GIFë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”!</div>';
          gifInfo.style.display = "none";
          currentGifData = null;
          
          // í ì´ˆê¸°í™”
          gifQueue = [];
          currentGifIndex = 0;
          
          // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
          if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
            isAutoRefreshing = false;
            updateAutoRefreshButton();
          }
        }

      function toggleAutoRefresh() {
        const btn = document.getElementById("autoRefreshBtn");

        if (isAutoRefreshing) {
          // ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
          if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
          }
          isAutoRefreshing = false;
          btn.textContent = "ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘";
          btn.style.background = "linear-gradient(45deg, #27ae60, #2ecc71)";
        } else {
          // ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
          autoRefreshInterval = setInterval(loadRandomGif, 5000); // 5ì´ˆë§ˆë‹¤
          isAutoRefreshing = true;
          btn.textContent = "â¹ï¸ ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€";
          btn.style.background = "linear-gradient(45deg, #e74c3c, #c0392b)";
        }
      }

      function updateAutoRefreshButton() {
        const btn = document.getElementById("autoRefreshBtn");
        if (isAutoRefreshing) {
          btn.textContent = "â¹ï¸ ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€";
          btn.style.background = "linear-gradient(45deg, #e74c3c, #c0392b)";
        } else {
          btn.textContent = "ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘";
          btn.style.background = "linear-gradient(45deg, #27ae60, #2ecc71)";
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì²« ë²ˆì§¸ GIF ë¡œë“œ
      window.addEventListener("load", () => {
        // 3ì´ˆ í›„ ìë™ ë¡œë“œ
        setTimeout(loadRandomGif, 3000);
      });
    </script>
  </body>
</html>
